<img id="main_orchestra" srcset="img/optimized/main_orchestra/main_orchestra.jpg 2328w,
             img/optimized/main_orchestra/main_orchestra@0,75x.jpg 1747w, img/optimized/main_orchestra/main_orchestra@0,5x.jpg 1164w,
             img/optimized/main_orchestra/main_orchestra@0,25x.jpg 584w" src="img/main_orchestra.jpg"
    alt="Main orchestra photo">

<div class="container  mt-3">

    <div class=" text-center my-3">

        <div class="separator container"><h3>{{__ 'layout.index.nextevents'}}</h3></div>

        <div class="row mx-auto my-auto">
            <div id="recipeCarousel" class="carousel slide w-100" data-ride="carousel" data-interval="5000">
                <div class="carousel-inner w-100" role="listbox">

                    {{#each triplets}}
                    <div class="carousel-item">
                        <div class="row">
                            {{#each this}}
                            <div class="col-4 p-2 p-md-3">
                                <div class="card card-body">
                                    <a href="/events#{{this.id}}">
                                        <img class="img-fluid" src="/img/posters/{{this.id}}.jpg" alt="">
                                    </a>
                                </div>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    {{/each}}

                    <script>
                        document.getElementsByClassName("carousel-item").item(0).classList.add("active");
                    </script>


                </div>
                <a class="carousel-control-prev w-auto" href="#recipeCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon " aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next w-auto" href="#recipeCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="separator container"><h3>{{__ 'layout.index.news'}}</h3></div>
       
        <div class="news-container">


        </div>



        <nav aria-label="...">
            <ul class="pagination">
                <li class="page-item ml-auto">
                    <p class="page-link">ðŸ¢”</p>
                </li>
            </ul>
        </nav>
    </div>



    <script>
        var MAXPAGE;
        var newsContainer = $(".news-container");
        var pagination = $(".pagination");
        var activePageLI;
        var activePage = 1;

        function addPaginationClickEvents() {
            $(".page-link").click(function () {
                var pageButtonText = $(this).text();
                var pageNum;
                if (Number.isInteger(Number(pageButtonText))) {
                    activePage = Number(pageButtonText);
                    pageNum = activePage;
                } else {
                    if (pageButtonText === "ðŸ¢”") {
                        activePage = (activePage - 1 >= 1) ? (activePage - 1) : (1);
                    } else {
                        activePage = (activePage + 1 > MAXPAGE) ? (MAXPAGE) : (activePage + 1);
                    }
                    pageNum = activePage;
                }
                activePageLI.removeClass("active");
                activePageLI = $(`#${activePage}`);
                activePageLI.addClass("active");


                $.getJSON("/api/news?block=" + pageNum, function (result) {
                    newsContainer.empty();
                    $.each(result, function (i, field) {
                        let dateString = (new Date(field.date)).toDateString();
                        let html = `<div class="block row my-3">\
                            <div class="col-md-5 col-12 p-0">\
                                <img class="musicians-pic full-width" src="/img/news/${field.id}.jpg" alt="">\
                            </div>\
                            <div class="col-md-7 col-12 px-4 py-1">\
                                <h6>${field.title}</h6>\
                                <div>${field.text}</div>\
                                <div class="concert-place">${dateString}</div>\
                                </div>\
                            </div>`;
                        newsContainer.append(html);
                    });

                });


                newsContainer.animate({ opacity: 1 }, 1000);

            });
        }

        $(document).ready(function () {
            $.getJSON("/api/news/count", function (result) {
                if (result[0].count > 5) { $(".pagination").css("display", "flex"); }

                MAXPAGE = Math.ceil(result[0].count / 5);
                for (var i = 1; i <= MAXPAGE; i++) {
                    var active = "";
                    if (i == 1) {
                        active = "active";
                    }
                    pagination.append(`<li class="page-item ${active}" id="${i}"><p class="page-link">${i}</p></li>`);
                }
                pagination.append(`<li class="page-item mr-auto"><p class="page-link" >ðŸ¢–</p></li>`);

                activePageLI = $(".active", pagination);

                addPaginationClickEvents();
                activePageLI.children().first().trigger("click");
            });
        });
    </script>

</div>