<img id="main_orchestra" src="img/main_orchestra.jpg" alt="">

<div class="container-fluid carousel-container mt-3">

    <div class="container-fluid text-center my-3">
        <h4 class="font-weight-light mb-3">Ближайшие концерты</h4>
        <div class="row mx-auto my-auto">
            <div id="recipeCarousel" class="carousel slide w-100" data-ride="carousel" data-interval="5000">
                <div class="carousel-inner w-100" role="listbox">

                    {{#each triplets}}
                    <div class="carousel-item">
                        <div class="card-deck">
                            {{#each this}}
                            <div class="card card-body">
                                <a href="/events#{{this.id}}">
                                    <img class="img-fluid" src="/img/posters/{{this.id}}.jpg">
                                </a>

                            </div>
                            {{/each}}
                        </div>
                    </div>
                    {{/each}}

                    <script>
                        document.getElementsByClassName("carousel-item").item(0).classList.add("active");
                    </script>


                </div>
                <a class="carousel-control-prev w-auto" href="#recipeCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon " aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next w-auto" href="#recipeCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
    </div>

    <div class="container">

        <h4 class="text-center my-3">Последние новости</h4>
        <div class="news-container">


        </div>

        <nav aria-label="...">
            <ul class="pagination">
                <li class="page-item ml-auto">
                    <p class="page-link">
                        <</p>
                </li>
            </ul>
        </nav>
    </div>



    <script>
        var MAXPAGE;
        var newsContainer = $(".news-container");
        var pagination = $(".pagination");
        var activePageLI;
        var activePage = 1;

        function addPaginationClickEvents() {
            $(".page-link").click(function () {
                var pageButtonText = $(this).text();
                var pageNum;
                if (Number.isInteger(Number(pageButtonText))) {
                    activePage = Number(pageButtonText);
                    pageNum = activePage;
                } else {
                    if (pageButtonText === "<") {
                        activePage = (activePage - 1 >= 1) ? (activePage - 1) : (1);
                    } else {
                        activePage = (activePage + 1 > MAXPAGE) ? (MAXPAGE) : (activePage + 1);
                    }
                    pageNum = activePage;
                }
                activePageLI.removeClass("active");
                activePageLI = $(`#${activePage}`);
                activePageLI.addClass("active");


                $.getJSON("/api/news?block=" + pageNum, function (result) {
                    newsContainer.empty();
                    $.each(result, function (i, field) {
                        let dateString=(new Date(field.date)).toDateString();
                        let html = `<div class="block row my-3">\
                            <div class="col-5 p-0">\
                                <img class="musicians-pic" src="/img/news/${field.id}.jpg" alt="">\
                            </div>\
                            <div class="col-7 px-4 py-1">\
                                <h3>${field.title}</h3>\
                                <p>${field.text}</p>\
                                <div class="concert-place">${dateString}</div>\
                                </div>\
                            </div>`;
                        newsContainer.append(html);
                    });

                });


                newsContainer.animate({ opacity: 1 }, 1000);

            });
        }

        $(document).ready(function () {
            $.getJSON("/api/news/count", function (result) {
                MAXPAGE = Math.ceil(result[0].count / 5);
                for (var i = 1; i <= MAXPAGE; i++) {
                    var active = "";
                    if (i == 1) {
                        active = "active";
                    }
                    pagination.append(`<li class="page-item ${active}" id="${i}"><p class="page-link">${i}</p></li>`);
                }
                pagination.append(`<li class="page-item mr-auto"><p class="page-link" >></p></li>`);
                activePageLI = $(".active", pagination);
                addPaginationClickEvents();
                activePageLI.children().first().trigger("click");
            });
        });
    </script>

</div>